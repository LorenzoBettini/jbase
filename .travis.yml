sudo: false

language: java

os:
  - linux
  - osx

cache:
  directories:
  - $HOME/.m2

env: DISPLAY=:99.0

install: true

before_install:
 - echo "MAVEN_OPTS='-Xmx2048m -XX:MaxPermSize=512m'" > ~/.mavenrc
 - if [ "$TRAVIS_OS_NAME" == "osx" ]; then export JAVA_HOME=$(/usr/libexec/java_home); fi
 - echo $JAVA_HOME

before_script:
 - sh -e ./before_script.sh

# Build on MacOSX is triggered only for pull requests
script:
 - export
 - '[ "$TRAVIS_OS_NAME" == "osx" ] && [ "${TRAVIS_PULL_REQUEST}" != "false" ] && mvn -f jbase.releng/pom.xml clean verify || [ "$TRAVIS_OS_NAME" != "osx" ] && mvn -f jbase.releng/pom.xml clean verify -U -Pjacoco-report coveralls:report || [ "$TRAVIS_OS_NAME" == "osx" ] && [ "${TRAVIS_PULL_REQUEST}" = "false" ]'